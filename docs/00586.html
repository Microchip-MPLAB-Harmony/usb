<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>USB_DEVICE_AUDIO_Write Function</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta name="save" content="history" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoad();" onmousedown="onBodyMouseDown();">
<div id="persistenceDiv" style="display:none; behavior:url(#default#userData);"></div>

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="00300.html">USB Libraries Help</a> &gt; <a href="00207.html">USB Device Libraries</a> &gt; <a href="00136.html">USB Audio 1.0 Device Library</a> &gt; <a href="00119.html">Library Interface</a> &gt; a) Functions &gt; <a href="00586.html">USB_DEVICE_AUDIO_Write Function</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony USB Stack </div>
</td><td width="25%">
<div class="Element2">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="00181.html">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="00538.html">Previous</a> | <a href="00119.html">Up</a> | <a href="00535.html">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: USB_DEVICE_AUDIO_Write@USB_DEVICE_AUDIO_INDEX@USB_DEVICE_AUDIO_TRANSFER_HANDLE *@uint8_t@void *@size_t Topic Title: USB_DEVICE_AUDIO_Write Function)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table><div class="Element5">
USB_DEVICE_AUDIO_Write Function</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<div class="Element58">
<a name="43"></a><div class="Element99">
C</div>
<div class="Element101"><div class="Element100"><pre class="Element100"><a href="00524.html">USB_DEVICE_AUDIO_RESULT</a> <strong><span style="color: #000000">USB_DEVICE_AUDIO_Write</span></strong>(
    <a href="00518.html">USB_DEVICE_AUDIO_INDEX</a> <strong><span style="color: #000000">instanceIndex</span></strong>, 
    <a href="00536.html">USB_DEVICE_AUDIO_TRANSFER_HANDLE</a> * <strong><span style="color: #000000">transferHandle</span></strong>, 
    uint8_t <strong><span style="color: #000000">interfaceNumber</span></strong>, 
    <strong><span style="color: #000080">void</span></strong> * <strong><span style="color: #000000">data</span></strong>, 
    size_t <strong><span style="color: #000000">size</span></strong>
);</pre></div></div>
<a name="4465736372697074696F6E"></a><div class="Element14">
Description</div>
<div class="Element11">
<div class="Element10">
<p class="Element10">
This function requests a data write to the USB Device Audio Function Driver Layer. The function places a requests with driver, the request will get serviced as data is requested by the USB Host. A handle to the request is returned in the transferHandle parameter. The termination of the request is indicated by the USB_DEVICE_AUDIO_EVENT_WRITE_COMPLETE event. The amount of data written and the transfer handle associated with the request is returned along with the event in writeCompleteData member of the pData parameter in the event handler.&nbsp;</p>
<p class="Element10">
The transfer handle expires when event handler for the USB_DEVICE_AUDIO_EVENT_WRITE_COMPLETE exits. If the write request could not be accepted, the function returns an error code and transferHandle will contain the value <a href="00537.html">USB_DEVICE_AUDIO_TRANSFER_HANDLE_INVALID</a>.</p></div>
</div>
<a name="507265636F6E646974696F6E73"></a><div class="Element14">
Preconditions</div>
<div class="Element11">
<div class="Element10">
<p class="Element10">
The function driver should have been configured.</p></div>
</div>
<a name="506172616D6574657273"></a><div class="Element14">
Parameters</div>
<div class="Element11">
<div class="Element10">
<div class="Element312">
<div class="TableDiv">
<table cellspacing="0" class="Table3">
<tr>
<td class="Element300" valign="top" width="35%">
<div class="Element301">
Parameters&nbsp;</div></td><td class="Element304" valign="top" width="65%">
<div class="Element305">
Description&nbsp;</div></td></tr><tr>
<td class="Element302" valign="top" width="35%">
<div class="Element303">
instance&nbsp;</div></td><td class="Element306" valign="top" width="65%">
<div class="Element307">
USB Device Audio Function Driver instance.&nbsp;</div></td></tr><tr>
<td class="Element302" valign="top" width="35%">
<div class="Element303">
transferHandle&nbsp;</div></td><td class="Element306" valign="top" width="65%">
<div class="Element307">
Pointer to a <a href="00536.html">USB_DEVICE_AUDIO_TRANSFER_HANDLE</a> type of variable. This variable will contain the transfer handle in case the write request was successful.&nbsp;</div></td></tr><tr>
<td class="Element302" valign="top" width="35%">
<div class="Element303">
interfaceNum&nbsp;</div></td><td class="Element306" valign="top" width="65%">
<div class="Element307">
The USB Audio streaming interface number on which the write request is to placed.&nbsp;</div></td></tr><tr>
<td class="Element302" valign="top" width="35%">
<div class="Element303">
data&nbsp;</div></td><td class="Element306" valign="top" width="65%">
<div class="Element307">
pointer to the data buffer contains the data to be written. In case of PIC32MZ device, this buffer should be located in coherent memory and should be aligned a 16 byte boundary.&nbsp;</div></td></tr><tr>
<td class="Element302" valign="top" width="35%">
<div class="Element303">
size&nbsp;</div></td><td class="Element306" valign="top" width="65%">
<div class="Element307">
Size of the data buffer.&nbsp;</div></td></tr></table></div></div>
</div>
</div>
<a name="52657475726E73"></a><div class="Element14">
Returns</div>
<div class="Element11">
<div class="Element10">

<ul class="Element630">
<li class="Element600">USB_DEVICE_AUDIO_RESULT_OK - The read request was successful. transferHandle</li>
</ul><p class="Element10">
contains a valid transfer handle.</p>
<ul class="Element630">
<li class="Element600">USB_DEVICE_AUDIO_RESULT_ERROR_TRANSFER_QUEUE_FULL - internal request queue</li>
</ul><p class="Element10">
is full. The write request could not be added.</p>
<ul class="Element630">
<li class="Element600">USB_DEVICE_AUDIO_RESULT_ERROR_INSTANCE_NOT_CONFIGURED - The specified</li>
</ul><p class="Element10">
instance is not configured yet.</p>
<ul class="Element630">
<li class="Element600">USB_DEVICE_AUDIO_RESULT_ERROR_INSTANCE_INVALID - The specified instance</li>
</ul><p class="Element10">
was not provisioned in the application and is invalid.</p></div>
</div>
<a name="52656D61726B73"></a><div class="Element14">
Remarks</div>
<div class="Element11">
<div class="Element10">
<p class="Element10">
While the using the Audio Function Driver with the PIC32MZ USB module, the audio buffer provided to the USB_DEVICE_AUDIO_Write function should be placed in coherent memory and aligned at a 16 byte boundary. This can be done by declaring the buffer using the __attribute__((coherent, aligned(16))) attribute. An example is shown here&nbsp;</p>
<p class="Element10">
&nbsp;</p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code00052');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code00052"><pre class="Element12">uint8_t data[256] __attribute__((coherent, aligned(16)));</pre></div></div>
</div>
</div>
<a name="4578616D706C65"></a><div class="Element14">
Example</div>
<div class="Element11">
<div class="Element10">
<div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code00053');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code00053"><pre class="Element12">
<i><span style="color: #008000">// Shows an example of how to write audio data to the audio streaming</span></i>
<i><span style="color: #008000">// interface . This assumes that device is configured and the audio</span></i>
<i><span style="color: #008000">// streaming interface is 1.</span></i>

<a href="00518.html">USB_DEVICE_AUDIO_INDEX</a> instanceIndex;
<a href="00536.html">USB_DEVICE_AUDIO_TRANSFER_HANDLE</a> transferHandle;
unit8_t interfaceNumber;
unit8_t txBuffer[192]; <i><span style="color: #008000">// Use this attribute for PIC32MZ __attribute__((coherent, aligned(16)))</span></i>
<a href="00524.html">USB_DEVICE_AUDIO_RESULT</a> writeRequestResult;

instanceIndex = 0; <i><span style="color: #008000">//specify the Audio Function driver instance number.</span></i>
interfaceNumber = 1; <i><span style="color: #008000">//Specify the Audio Streaming interface number.</span></i>

writeRequestResult = USB_DEVICE_AUDIO_Write ( instanceIndex, &amp;transferHandle,
                            interfaceNumber, &amp;txBuffer, 192);

<strong><span style="color: #000080">if</span></strong>(USB_DEVICE_AUDIO_RESULT_OK != writeRequestResult)
{
    <i><span style="color: #008000">//Do Error handling here</span></i>
}

<i><span style="color: #008000">// The completion of the write request will be indicated by the</span></i>
<i><span style="color: #008000">// USB_DEVICE_AUDIO_EVENT_WRITE_COMPLETE event. The transfer handle</span></i>
<i><span style="color: #008000">// and transfer size is provided along with this event.</span></i>
</pre></div></div>
</div>
</div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="00300.html">USB Libraries Help</a> &gt; <a href="00207.html">USB Device Libraries</a> &gt; <a href="00136.html">USB Audio 1.0 Device Library</a> &gt; <a href="00119.html">Library Interface</a> &gt; a) Functions &gt; <a href="00586.html">USB_DEVICE_AUDIO_Write Function</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="100%">
<div class="Element3">
 MPLAB Harmony USB Stack </div>
</td></tr><tr><td width="100%">
<div class="Element4">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="00181.html">Home</a></div>
</td></tr><tr><td width="100%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: USB_DEVICE_AUDIO_Write@USB_DEVICE_AUDIO_INDEX@USB_DEVICE_AUDIO_TRANSFER_HANDLE *@uint8_t@void *@size_t Topic Title: USB_DEVICE_AUDIO_Write Function)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>