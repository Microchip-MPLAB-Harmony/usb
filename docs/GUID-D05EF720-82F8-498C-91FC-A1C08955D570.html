<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us" data-whc_version="24.1">
    <head><link rel="shortcut icon" href="oxygen-webhelp\template\resources/images/favicon.ico"/><link rel="icon" href="oxygen-webhelp\template\resources/images/favicon.ico"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="This section describes the USBCD operations such as setting event handlers and attaching and detaching the device. Handling Device Mode Driver Events The Device Layer will call the USBCD ..."/><meta name="copyright" content="(C) Copyright 2024"/><meta name="generator" content="DITA-OT"/><title>4.1.6.1 General Device Mode Operations</title><!--  Generated with Oxygen version 24.1, build number 2022062014.  --><meta name="wh-path2root" content=""/><meta name="wh-toc-id" content="GUID-D05EF720-82F8-498C-91FC-A1C08955D570-d5059e5477"/><meta name="wh-source-relpath" content="GUID-D05EF720-82F8-498C-91FC-A1C08955D570.xml"/><meta name="wh-out-relpath" content="GUID-D05EF720-82F8-498C-91FC-A1C08955D570.html"/>
    <!-- Latest compiled and minified Bootstrap CSS -->
    <link rel="stylesheet" type="text/css" href="./oxygen-webhelp/lib/bootstrap/css/bootstrap.min.css"/>
    
    <link rel="stylesheet" href="./oxygen-webhelp/lib/jquery-ui/jquery-ui.min.css"/>
    
    <!-- Template default styles  -->
    <link rel="stylesheet" type="text/css" href="./oxygen-webhelp/app/topic-page.css?buildId=2022062014"/>
    
    
    <script src="./oxygen-webhelp/lib/jquery/jquery-3.5.1.min.js"></script>
    
    <script data-main="./oxygen-webhelp/app/topic-page.js" src="./oxygen-webhelp/lib/requirejs/require.js"></script>
<link rel="stylesheet" type="text/css" href="oxygen-webhelp/template/microchip.css?buildId=2022062014"/><link rel="stylesheet" type="text/css" href="oxygen-webhelp/template/notes.css?buildId=2022062014"/>
<script src="mchp-context-help.js"></script>
<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300" rel="stylesheet" type="text/css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async="" type="text/javascript"></script>
    <script src="https://assets.adobedtm.com/6a72a357eb48/a636c708c7fe/launch-0b0023397020.min.js"></script><!-- Adobe Analytics -->
</head>

    <body id="GUID-D05EF720-82F8-498C-91FC-A1C08955D570" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            Jump to main content
        </a>
        
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div class="wh_header_flex_container navbar-nav navbar-expand-md navbar-dark">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <a href="index.html" class=" wh_logo d-none d-sm-block "><img src="oxygen-webhelp\template\resources/images/microchip.png" alt="MPLAB® Harmony 3 USB Library &#xA;    "/></a>
                    <div class=" wh_publication_title "><a href="index.html">MPLAB® Harmony 3 USB Library 
    </a></div>
                    
                </div>
                
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                
                
                
            </div>
        </div>
    </div>
</header>
        
        
         
        
        <div class=" wh_search_input navbar-form wh_topic_page_search search " role="form">
            
            
            
            <form id="searchForm" method="get" role="search" action="search.html"><div class="d-flex justify-contents-around"><div class="flex-grow-1"></div><div class="position-relative flex-grow-1"><input type="search" placeholder="Search " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="Search query" required="required"/><button type="submit" class="wh_search_button" aria-label="Search"><span class="search_input_text">Search</span></button></div><div class="align-self-center flex-grow-1 ml-2"></div></div></form>
            
            <div class="mchp-color-stripe-grid-container">
  <div class="mchp-main-bar mchp-orange-bar"></div>
  <div class="mchp-main-bar mchp-blue-bar"></div>
  <div class="mchp-main-bar mchp-green-bar"></div>
</div>
            
        </div>
        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="index.html"><span>Home</span></a></span></li><li><div class="topicref" data-id="GUID-6AFB98D6-0272-4DED-BBAB-39EECD8DDB5F"><div class="title"><a href="GUID-6AFB98D6-0272-4DED-BBAB-39EECD8DDB5F.html"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4</ph>
USB Common Driver Interface</a></div></div></li><li><div class="topicref" data-id="GUID-7B57189D-AB41-4208-8FBA-0C1C2C9DAE39"><div class="title"><a href="GUID-7B57189D-AB41-4208-8FBA-0C1C2C9DAE39.html"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1</ph>
Common Interface</a></div></div></li><li><div class="topicref" data-id="GUID-4D46C075-0FAB-49DF-8561-98820CD2536B"><div class="title"><a href="GUID-4D46C075-0FAB-49DF-8561-98820CD2536B.html"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1.6</ph>
USB Driver Device Mode Operation</a></div></div></li><li class="active"><div class="topicref" data-id="GUID-D05EF720-82F8-498C-91FC-A1C08955D570"><div class="title"><a href="GUID-D05EF720-82F8-498C-91FC-A1C08955D570.html"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1.6.1</ph>
General Device Mode Operations</a></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="Toggle search highlights" title="Toggle search highlights"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="Collapse sections" title="Collapse sections"></button>
                        
                        
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="Print this page" aria-label="Print this page"></button></div>
                        
                        <button type="button" id="wh_toc_button" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            <div class="row" style="margin-top: -1em;"><div class="col-lg-7 col-md-7 col-sm-12 offset-lg-3 offset-md-3 text-right border-bottom mb-1"><h2 class="text-dark header_title">
    </h2></div></div>
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        <nav id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-12 d-md-block d-none d-print-none" aria-label="Table of Contents Container">
                            <div id="wh_publication_toc_content">
		                        
                            	<div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem" aria-expanded="false"><div data-tocid="GUID-D9F90103-F97D-468D-90FC-EA3E186842D9-d5059e11" class="topicref" data-id="GUID-D9F90103-F97D-468D-90FC-EA3E186842D9" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action GUID-D9F90103-F97D-468D-90FC-EA3E186842D9-d5059e11-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-D9F90103-F97D-468D-90FC-EA3E186842D9.html" id="GUID-D9F90103-F97D-468D-90FC-EA3E186842D9-d5059e11-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1</ph>
Release Information</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="GUID-61902145-0FA6-4DE3-845C-B14852166EAE-d5059e27" class="topicref" data-id="GUID-61902145-0FA6-4DE3-845C-B14852166EAE" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action GUID-61902145-0FA6-4DE3-845C-B14852166EAE-d5059e27-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-61902145-0FA6-4DE3-845C-B14852166EAE.html" id="GUID-61902145-0FA6-4DE3-845C-B14852166EAE-d5059e27-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">2</ph>
USB Device Libraries</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="GUID-B14EBEC0-7590-4740-800B-6CE5FE9AB121-d5059e3093" class="topicref" data-id="GUID-B14EBEC0-7590-4740-800B-6CE5FE9AB121" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action GUID-B14EBEC0-7590-4740-800B-6CE5FE9AB121-d5059e3093-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-B14EBEC0-7590-4740-800B-6CE5FE9AB121.html" id="GUID-B14EBEC0-7590-4740-800B-6CE5FE9AB121-d5059e3093-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">3</ph>
USB Host Libraries</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="GUID-6AFB98D6-0272-4DED-BBAB-39EECD8DDB5F-d5059e5397" class="topicref" data-id="GUID-6AFB98D6-0272-4DED-BBAB-39EECD8DDB5F" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action GUID-6AFB98D6-0272-4DED-BBAB-39EECD8DDB5F-d5059e5397-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-6AFB98D6-0272-4DED-BBAB-39EECD8DDB5F.html" id="GUID-6AFB98D6-0272-4DED-BBAB-39EECD8DDB5F-d5059e5397-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4</ph>
USB Common Driver Interface</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="true"><div data-tocid="GUID-7B57189D-AB41-4208-8FBA-0C1C2C9DAE39-d5059e5405" class="topicref" data-id="GUID-7B57189D-AB41-4208-8FBA-0C1C2C9DAE39" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action GUID-7B57189D-AB41-4208-8FBA-0C1C2C9DAE39-d5059e5405-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-7B57189D-AB41-4208-8FBA-0C1C2C9DAE39.html" id="GUID-7B57189D-AB41-4208-8FBA-0C1C2C9DAE39-d5059e5405-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1</ph>
Common Interface</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="false"><div data-tocid="GUID-DAE7BD2C-129E-4F03-BF5D-3A315C9DEF45-d5059e5413" class="topicref" data-id="GUID-DAE7BD2C-129E-4F03-BF5D-3A315C9DEF45" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action GUID-DAE7BD2C-129E-4F03-BF5D-3A315C9DEF45-d5059e5413-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-DAE7BD2C-129E-4F03-BF5D-3A315C9DEF45.html" id="GUID-DAE7BD2C-129E-4F03-BF5D-3A315C9DEF45-d5059e5413-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1.1</ph>
Driver Host Mode Client Functions</a></div></div></li><li role="treeitem"><div data-tocid="GUID-1B002121-F8DD-4F43-B052-BF0BD1C4CEC6-d5059e5437" class="topicref" data-id="GUID-1B002121-F8DD-4F43-B052-BF0BD1C4CEC6" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="GUID-1B002121-F8DD-4F43-B052-BF0BD1C4CEC6.html" id="GUID-1B002121-F8DD-4F43-B052-BF0BD1C4CEC6-d5059e5437-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1.2</ph>
Driver Device Mode Client Functions</a></div></div></li><li role="treeitem"><div data-tocid="GUID-0F4E88DE-15B9-4CE8-9B09-044A80E81C4D-d5059e5445" class="topicref" data-id="GUID-0F4E88DE-15B9-4CE8-9B09-044A80E81C4D" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="GUID-0F4E88DE-15B9-4CE8-9B09-044A80E81C4D.html" id="GUID-0F4E88DE-15B9-4CE8-9B09-044A80E81C4D-d5059e5445-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1.3</ph>
Driver General Client Functions</a></div></div></li><li role="treeitem"><div data-tocid="GUID-655F3E4F-8C51-4725-9838-73500FD7AF00-d5059e5453" class="topicref" data-id="GUID-655F3E4F-8C51-4725-9838-73500FD7AF00" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="GUID-655F3E4F-8C51-4725-9838-73500FD7AF00.html" id="GUID-655F3E4F-8C51-4725-9838-73500FD7AF00-d5059e5453-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1.4</ph>
Opening the Driver</a></div></div></li><li role="treeitem"><div data-tocid="GUID-364A16EE-4ABA-46E5-91D2-DD954EEEA6E1-d5059e5461" class="topicref" data-id="GUID-364A16EE-4ABA-46E5-91D2-DD954EEEA6E1" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="GUID-364A16EE-4ABA-46E5-91D2-DD954EEEA6E1.html" id="GUID-364A16EE-4ABA-46E5-91D2-DD954EEEA6E1-d5059e5461-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1.5</ph>
USB Driver Host Mode Operation</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="GUID-4D46C075-0FAB-49DF-8561-98820CD2536B-d5059e5469" class="topicref" data-id="GUID-4D46C075-0FAB-49DF-8561-98820CD2536B" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action GUID-4D46C075-0FAB-49DF-8561-98820CD2536B-d5059e5469-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-4D46C075-0FAB-49DF-8561-98820CD2536B.html" id="GUID-4D46C075-0FAB-49DF-8561-98820CD2536B-d5059e5469-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1.6</ph>
USB Driver Device Mode Operation</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" class="active"><div data-tocid="GUID-D05EF720-82F8-498C-91FC-A1C08955D570-d5059e5477" class="topicref" data-id="GUID-D05EF720-82F8-498C-91FC-A1C08955D570" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="GUID-D05EF720-82F8-498C-91FC-A1C08955D570.html" id="GUID-D05EF720-82F8-498C-91FC-A1C08955D570-d5059e5477-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1.6.1</ph>
General Device Mode Operations</a></div></div></li><li role="treeitem"><div data-tocid="GUID-A46EB55F-A77A-4E57-A921-096F2396F51A-d5059e5485" class="topicref" data-id="GUID-A46EB55F-A77A-4E57-A921-096F2396F51A" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="GUID-A46EB55F-A77A-4E57-A921-096F2396F51A.html" id="GUID-A46EB55F-A77A-4E57-A921-096F2396F51A-d5059e5485-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1.6.2</ph>
Device Endpoint Operations</a></div></div></li><li role="treeitem"><div data-tocid="GUID-58EAFD35-9DB6-4F9F-970B-DD7C7ED13C8B-d5059e5493" class="topicref" data-id="GUID-58EAFD35-9DB6-4F9F-970B-DD7C7ED13C8B" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="GUID-58EAFD35-9DB6-4F9F-970B-DD7C7ED13C8B.html" id="GUID-58EAFD35-9DB6-4F9F-970B-DD7C7ED13C8B-d5059e5493-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1.6.3</ph>
Transferring Data to the Host</a></div></div></li></ul></li></ul></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="GUID-0FB3F908-88EE-45CE-94F5-E97AF9049C9B-d5059e5501" class="topicref backmatter backmatter_parent" data-id="GUID-0FB3F908-88EE-45CE-94F5-E97AF9049C9B" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action GUID-0FB3F908-88EE-45CE-94F5-E97AF9049C9B-d5059e5501-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-0FB3F908-88EE-45CE-94F5-E97AF9049C9B.html" id="GUID-0FB3F908-88EE-45CE-94F5-E97AF9049C9B-d5059e5501-link">Microchip Information</a></div></div></li></ul></div>
		                        
                            </div>
                        </nav>
                    
                    
                    <div class="col-lg-7 col-md-9 col-sm-12" id="wh_topic_body">
                        <button id="wh_close_publication_toc_button" class="close-toc-button d-none" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        <button id="wh_close_topic_toc_button" class="close-toc-button d-none" aria-label="Toggle topic table of content" aria-controls="wh_topic_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        
                        <div class=" wh_topic_content body "><main role="main"><article role="article" aria-labelledby="GUID-D05EF720-82F8-498C-91FC-A1C08955D570__GUID-54D7F3E8-5416-4B53-8BCE-8EB55A8D626C">
<h1 class="- topic/title title topictitle1" id="GUID-D05EF720-82F8-498C-91FC-A1C08955D570__GUID-54D7F3E8-5416-4B53-8BCE-8EB55A8D626C" style="">4.1.6.1 General Device Mode Operations</h1>
    <div class="- topic/body body">
        <p class="- topic/p p">This section describes the USBCD operations such as setting event handlers and attaching
            and detaching the device.</p>
        <section class="- topic/section section" id="GUID-D05EF720-82F8-498C-91FC-A1C08955D570__SECTION_GQX_THF_Q1C" data-ofbid="GUID-D05EF720-82F8-498C-91FC-A1C08955D570__SECTION_GQX_THF_Q1C"><h2 class="- topic/title title sectiontitle">Handling Device Mode Driver Events</h2>
            
            <p class="- topic/p p">The Device Layer will call the USBCD eventHandlerSet function to register the Device
                mode event handling function. The USBCD generates various events that indicate
                different states of the USB. These events are defined by the DRV_USB_EVENT
                enumeration. The following code example shows how the Device Layer registers the
                driver event handling function.</p>
            <pre class="- topic/pre pre" id="GUID-D05EF720-82F8-498C-91FC-A1C08955D570__PRE_JXF_SHF_Q1C" data-ofbid="GUID-D05EF720-82F8-498C-91FC-A1C08955D570__PRE_JXF_SHF_Q1C"><em class="+ topic/ph hi-d/i ph i">/* This code example shows the implementation of the USB_DEVICE_Attach and the
 * USB_DEVICE_Detach function. These functions are actually macro that map
 * directly deviceAttach and the deviceDetach function of the driverInterface
 * member of the deviceClient Object (which is the macro parameter) */</em>
<strong class="+ topic/ph hi-d/b ph b">#define</strong> USB_DEVICE_Attach( x )  ((USB_DEVICE_OBJ *)x)-&gt;driverInterface-&gt;deviceAttach
                                ( ((USB_DEVICE_OBJ *)(x))-&gt;usbCDHandle)
<strong class="+ topic/ph hi-d/b ph b">#define</strong> USB_DEVICE_Detach( x )  ((USB_DEVICE_OBJ *)x)-&gt;driverInterface-&gt;deviceDetach
                                ( ((USB_DEVICE_OBJ *)x)-&gt;usbCDHandle)</pre>
            <p class="- topic/p p">If the driver is operating in interrupt mode, the client event handling function will
                execute in an interrupt context. The client should not call interrupt unsafe,
                computationally intensive or blocking functions in the event handler. The following
                code shows a small example of the Device Layer USBCD Event Handler:</p>
            <pre class="- topic/pre pre" id="GUID-D05EF720-82F8-498C-91FC-A1C08955D570__PRE_KXF_SHF_Q1C" data-ofbid="GUID-D05EF720-82F8-498C-91FC-A1C08955D570__PRE_KXF_SHF_Q1C"><em class="+ topic/ph hi-d/i ph i">/* This code example shows a partial implementation of the USB Device Layer
 * event handler. Note how the code type casts the referenceHandle parameter to
 * a USB_DEVICE_OBJ type. This referenceHandle is the same value that the Device
 * Layer passed when the event handler was set. This now easily allows one
 * implementation of the event handling code to be used by multiple Device
 * Layer instances. */</em>
<strong class="+ topic/ph hi-d/b ph b">void</strong> _USB_DEVICE_EventHandler
(
    uintptr_t referenceHandle,
    DRV_USB_EVENT eventType,
    <strong class="+ topic/ph hi-d/b ph b">void</strong> * eventData
)
{
    USB_DEVICE_OBJ* usbDeviceThisInstance;
    USB_DEVICE_MASTER_DESCRIPTOR * ptrMasterDescTable;
    USB_DEVICE_EVENT_DATA_SOF SOFFrameNumber;

    usbDeviceThisInstance = (USB_DEVICE_OBJ *)referenceHandle;

    <em class="+ topic/ph hi-d/i ph i">/* Handle events, only if this instance is in initialized state */</em>
    <strong class="+ topic/ph hi-d/b ph b">if</strong>( usbDeviceThisInstance-&gt;usbDeviceInstanceState &lt;= SYS_STATUS_UNINITIALIZED )
    {
        <em class="+ topic/ph hi-d/i ph i">/* The device should anyway not be attached when the Device Layer is
         * not initialized. If we receive driver event when the Device Layer is
         * not initialized, there is nothing we can do but ignore them. */</em>
        <strong class="+ topic/ph hi-d/b ph b">return</strong>;
    }

    <strong class="+ topic/ph hi-d/b ph b">switch</strong>(eventType)
    {
        <strong class="+ topic/ph hi-d/b ph b">case</strong> DRV_USB_EVENT_RESET_DETECT:

            <em class="+ topic/ph hi-d/i ph i">/* Clear the suspended state */</em>
            usbDeviceThisInstance-&gt;usbDeviceStatusStruct.isSuspended = <strong class="+ topic/ph hi-d/b ph b">false</strong>;

            <em class="+ topic/ph hi-d/i ph i">/* Cancel any IRP already submitted in the RX direction. */</em>
            DRV_USB_DEVICE_IRPCancelAll( usbDeviceThisInstance-&gt;usbCDHandle,
                    controlEndpointRx );

            <em class="+ topic/ph hi-d/i ph i">/* Code not shown for the sake of brevity. */</em>

    }
}</pre>
            <p class="- topic/p p">In the previous code example, the Device Layer (the Driver Client) sets the
                    <code class="+ topic/ph pr-d/codeph ph codeph">hReferenceData</code> parameter, of the Event Handler Set function, to
                point to a local object. This pointer is returned to the Device Layer, in the event
                handler when an event occurs. For multiple instances of USB drivers in one
                application, this allows the Device Layer to easily associate a Device Layer
                specific context to the driver instance, thus simplifying implementation of the
                event handler.</p>
        </section>
        <section class="- topic/section section" id="GUID-D05EF720-82F8-498C-91FC-A1C08955D570__SECTION_KNX_XHF_Q1C" data-ofbid="GUID-D05EF720-82F8-498C-91FC-A1C08955D570__SECTION_KNX_XHF_Q1C"><h2 class="- topic/title title sectiontitle">Attaching and Detaching the Device</h2>
            
            <p class="- topic/p p">The USB Device Layer calls the USBCD deviceAttach and deviceDetach functions to
                attach and detach the device on the USB. The USB Device Layer should be ready to
                handle events which would occur when the device is attached on the bus. Hence the
                USB Device Layer should register the USBCD event handler before the attach function
                is called. The deviceAttach and deviceDetach functions can be called in an interrupt
                context. These functions are respectively called when the USB Device application
                detects a valid VBUS voltage and when the VBUS voltage is not valid.</p>
            <p class="- topic/p p">Setting the Device Address</p>
            <p class="- topic/p p">The USB Device Layer will call the USBCD deviceAddressSet function to set the USB
                address of the device. The Device Layer will do this when it receives the Set
                Address control request from the Host. The USBCD will reset the device address to
                    '<code class="+ topic/ph pr-d/codeph ph codeph">0</code>' when it has received reset signaling from the root hub. The
                following code example shows how the USB Device Layer calls this function.</p>
            <pre class="- topic/pre pre" id="GUID-D05EF720-82F8-498C-91FC-A1C08955D570__PRE_LXF_SHF_Q1C" data-ofbid="GUID-D05EF720-82F8-498C-91FC-A1C08955D570__PRE_LXF_SHF_Q1C"><em class="+ topic/ph hi-d/i ph i">/* The following code example shows how the USB Device Layer calls the
 * DRV_USB_DEVICE_AddressSet function to set the address. The
 * DRV_USB_DEVICE_AddressSet function is actually a macro that calls the
 * deviceAddressSet function of the driverInterface of usbDeviceThisInstance
 * object. The usbDeviceThisInstance is Device Layer object.
 *
 * As seen in this code, the Device Layer calls the address set function when
 * the it a pending set address control request from the Host has completed. */</em>
<strong class="+ topic/ph hi-d/b ph b">void</strong> _USB_DEVICE_Ep0TransmitCompleteCallback(USB_DEVICE_IRP * handle)
{
    USB_DEVICE_IRP * irpHandle = (USB_DEVICE_IRP *)handle;
    USB_DEVICE_OBJ * usbDeviceThisInstance;
    USB_DEVICE_CONTROL_TRANSFER_STRUCT * controlTransfer;

    usbDeviceThisInstance = (USB_DEVICE_OBJ *)irpHandle-&gt;userData;
    controlTransfer = &amp;(usbDeviceThisInstance-&gt;controlTransfer);

    <strong class="+ topic/ph hi-d/b ph b">if</strong>(irpHandle-&gt;status == USB_DEVICE_IRP_STATUS_ABORTED)
    {
        <strong class="+ topic/ph hi-d/b ph b">return</strong>;
    }

    <strong class="+ topic/ph hi-d/b ph b">if</strong>(usbDeviceThisInstance-&gt;usbDeviceStatusStruct.setAddressPending)
    {
        DRV_USB_DEVICE_AddressSet(usbDeviceThisInstance-&gt;usbCDHandle,
                                  usbDeviceThisInstance-&gt;deviceAddress);
        usbDeviceThisInstance-&gt;usbDeviceStatusStruct.setAddressPending = <strong class="+ topic/ph hi-d/b ph b">false</strong>;
    }

    <em class="+ topic/ph hi-d/i ph i">/* Code not shown for the sake of brevity */</em>

}</pre>
        </section>
        <section class="- topic/section section" id="GUID-D05EF720-82F8-498C-91FC-A1C08955D570__SECTION_SDQ_B3F_Q1C" data-ofbid="GUID-D05EF720-82F8-498C-91FC-A1C08955D570__SECTION_SDQ_B3F_Q1C"><h2 class="- topic/title title sectiontitle">Device Current Speed and SOF Number</h2>
            
            <p class="- topic/p p">The USB Device Layer will call the USBCD deviceCurrentSpeedGet function to know the
                speed at which the device is attached to the USB. This allows the Device Layer to
                select the correct endpoint settings at the time of processing the Set Configuration
                request issued by the Host. The USB Device Layer will call the deviceSOFNumberGet
                function to return the SOF number at the time of the SOF event.</p>
        </section>
        <section class="- topic/section section" id="GUID-D05EF720-82F8-498C-91FC-A1C08955D570__SECTION_KWN_F3F_Q1C" data-ofbid="GUID-D05EF720-82F8-498C-91FC-A1C08955D570__SECTION_KWN_F3F_Q1C"><h2 class="- topic/title title sectiontitle">Device Remote Wake-up</h2>
            
            <p class="- topic/p p">The USB Device Layer will call the USBCD deviceRemoteWakeupStop and
                deviceRemoteWakeupStart functions to stop and start remote signaling. The Device
                layer application will call the USB Device Layer Stop and Start Remote Wakeup
                Signaling functions to remotely let the root hub know that the device is ready to be
                woken up. The timing of the remote signaling is controlled by the Device Layer. The
                client should call the remote wakeup function only when the device is suspended by
                the Host.</p>
        </section>
    </div>
</article></main></div>
                        
                        
                        
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" aria-label="On this page" class="col-lg-2 d-none d-lg-block navbar d-print-none"> 
                            <div id="wh_topic_toc_content">
		                        
	                            <div class=" wh_topic_toc "><div class="wh_topic_label">On this page</div><ul><li class="section-item"><div class="section-title"><a href="#GUID-D05EF720-82F8-498C-91FC-A1C08955D570__SECTION_GQX_THF_Q1C" data-tocid="GUID-D05EF720-82F8-498C-91FC-A1C08955D570__SECTION_GQX_THF_Q1C">Handling Device Mode Driver Events</a></div></li><li class="section-item"><div class="section-title"><a href="#GUID-D05EF720-82F8-498C-91FC-A1C08955D570__SECTION_KNX_XHF_Q1C" data-tocid="GUID-D05EF720-82F8-498C-91FC-A1C08955D570__SECTION_KNX_XHF_Q1C">Attaching and Detaching the Device</a></div></li><li class="section-item"><div class="section-title"><a href="#GUID-D05EF720-82F8-498C-91FC-A1C08955D570__SECTION_SDQ_B3F_Q1C" data-tocid="GUID-D05EF720-82F8-498C-91FC-A1C08955D570__SECTION_SDQ_B3F_Q1C">Device Current Speed and SOF Number</a></div></li><li class="section-item"><div class="section-title"><a href="#GUID-D05EF720-82F8-498C-91FC-A1C08955D570__SECTION_KWN_F3F_Q1C" data-tocid="GUID-D05EF720-82F8-498C-91FC-A1C08955D570__SECTION_KWN_F3F_Q1C">Device Remote Wake-up</a></div></li></ul></div>
	                        	
                        	</div>
                        </nav>
                    
                </div>
            </div>
            
            
            
        </div> 
        <footer class="navbar navbar-default wh_footer">
  <div class=" footer-container mx-auto ">
    <div class="footer">
  <div class="mchp-wh-footer">
    <div class="mchp-footer">
      <div class="mchp-footer-tier1">
        <div class="spacer"></div>
        <div class="mchp-footer-container">
          <div class="mchp-footer-links mchp-social-media-links">
            <div class="mchp-component-items">
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.facebook.com/pages/Microchip-Technology-Inc/20320981741" target="_blank">
                  <img class="cmp-image__image" alt="Microchip Facebook" src="oxygen-webhelp/template/resources/images/201016-corp-facebook.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.linkedin.com/company/microchip-technology" target="_blank">
                  <img class="cmp-image__image" alt="Microchip LinkedIn" src="oxygen-webhelp/template/resources/images/201016-corp-linkedin.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://twitter.com/MicrochipTech" target="_blank">
                  <img class="cmp-image__image" alt="Microchip Twitter" src="oxygen-webhelp/template/resources/images/201016-corp-twitter.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.youtube.com/user/MicrochipTechnology" target="_blank">
                  <img class="cmp-image__image" alt="Microchip YouTube" src="oxygen-webhelp/template/resources/images/201016-corp-youtube.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.instagram.com/microchiptechnologyinc/" target="_blank">
                  <img class="cmp-image__image" alt="Microchip Instagram" src="oxygen-webhelp/template/resources/images/201016-corp-instagram.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.weibo.com/microchiptech" target="_blank">
                  <img class="cmp-image__image" alt="Microchip Weibo" src="oxygen-webhelp/template/resources/images/201016-corp-weibo.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.microchip.com/en-us/about/blog" target="_blank">
                  <img class="cmp-image__image" alt="Microchip Blog" src="oxygen-webhelp/template/resources/images/201016-corp-blog.png"/>
                </a>
              </div>
            </div>
          </div>
          <div class="mchp-footer-links">
            <div class="mchp-component-items">
              <div class="mchp-component-item">
                <div class="link">
                  <a href="https://www.microchip.com/about-us/contact-us" class="mchp-link__link">Contact</a>
                  <span class="mchp-link__separator">|</span>
                </div>
              </div>
              <div class="mchp-component-item ">
                <div class="link">
                  <a href="https://www.microchip.com/en-us/about/legal-information" class="mchp-link__link">Legal</a>
                  <span class="mchp-link__separator">|</span>
                </div>
              </div>
              <div class="mchp-component-item ">
                <div class="link">
                  <a href="https://www.microchip.com/en-us/about/legal-information/privacy-policy" class="mchp-link__link">Privacy Policy</a>
                  <span class="mchp-link__separator">|</span>
                </div>
              </div>
              <div class="mchp-component-item ">
                <div class="link">
                  <a href="https://www.microchip.com/en-us/about/legal-information/microchip-cookie-statement" class="mchp-link__link">Cookies</a>
                  <span class="mchp-link__separator">|</span>
                </div>
              </div>
              <div class="mchp-component-item">
                <div class="link">
                  <a href="https://careers.microchip.com/" class="mchp-link__link">Careers</a>
                  <span class="mchp-link__separator"></span>
                </div>
              </div>
            </div>
          </div>
          <div class="mchp-footer-newsletter">
            <div class="cmp-text">
              <p>Stay on the leading edge with our blog</p>
            </div>
            <div class="mchp-button-wrapper">
              <a role="button" href="https://www.microchip.com/en-us/about/blog" class="mchp-button mchp-button-regular solid">
                <span class="mchp-button__span">MicroSolutions</span>
              </a>
            </div>
          </div>
        </div>
        <div class="graphic">
          <img src="oxygen-webhelp/template/resources/images/footer-graphic.png"/>
        </div>
      </div>
      <div class="mchp-footer-tier2">
        <p class="mchp-copyright">© Copyright 1998-2022 Microchip Technology Inc. All rights reserved.</p>
      </div>
    </div>
  </div>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async="true" src="https://www.googletagmanager.com/gtag/js?id=UA-2724382-19"></script>
  <script>
    window.dataLayer = window.dataLayer || [];  
    function gtag(){dataLayer.push(arguments);}  
    gtag('js', new Date());   
    gtag('config', 'UA-2724382-19');
  </script>
  
  <script type="text/javascript">_satellite.pageBottom();</script><!-- Adobe Analytics -->
  <script type="text/javascript" src="mchp-js/prepend.js"></script><!-- Package for viewing PDFs on mobile devices -->
  
</div>
  </div>
</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <div id="modal_img_container"></div>
            <div id="caption"></div>
        </div>
        
        
        
       
        </body>
</html>