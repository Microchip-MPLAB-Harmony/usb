<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us" data-whc_version="24.1">
    <head><link rel="shortcut icon" href="oxygen-webhelp\template\resources/images/favicon.ico"/><link rel="icon" href="oxygen-webhelp\template\resources/images/favicon.ico"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="The USB Device Layer, the USBCD client, needs to transfer data to the Host in response to enumeration requests for general operation on the device. The USB uses a concept of Input Output Request ..."/><meta name="copyright" content="(C) Copyright 2024"/><meta name="generator" content="DITA-OT"/><title>4.1.6.3 Transferring Data to the Host</title><!--  Generated with Oxygen version 24.1, build number 2022062014.  --><meta name="wh-path2root" content=""/><meta name="wh-toc-id" content="GUID-58EAFD35-9DB6-4F9F-970B-DD7C7ED13C8B-d5059e5493"/><meta name="wh-source-relpath" content="GUID-58EAFD35-9DB6-4F9F-970B-DD7C7ED13C8B.xml"/><meta name="wh-out-relpath" content="GUID-58EAFD35-9DB6-4F9F-970B-DD7C7ED13C8B.html"/>
    <!-- Latest compiled and minified Bootstrap CSS -->
    <link rel="stylesheet" type="text/css" href="./oxygen-webhelp/lib/bootstrap/css/bootstrap.min.css"/>
    
    <link rel="stylesheet" href="./oxygen-webhelp/lib/jquery-ui/jquery-ui.min.css"/>
    
    <!-- Template default styles  -->
    <link rel="stylesheet" type="text/css" href="./oxygen-webhelp/app/topic-page.css?buildId=2022062014"/>
    
    
    <script src="./oxygen-webhelp/lib/jquery/jquery-3.5.1.min.js"></script>
    
    <script data-main="./oxygen-webhelp/app/topic-page.js" src="./oxygen-webhelp/lib/requirejs/require.js"></script>
<link rel="stylesheet" type="text/css" href="oxygen-webhelp/template/microchip.css?buildId=2022062014"/><link rel="stylesheet" type="text/css" href="oxygen-webhelp/template/notes.css?buildId=2022062014"/>
<script src="mchp-context-help.js"></script>
<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300" rel="stylesheet" type="text/css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async="" type="text/javascript"></script>
    <script src="https://assets.adobedtm.com/6a72a357eb48/a636c708c7fe/launch-0b0023397020.min.js"></script><!-- Adobe Analytics -->
</head>

    <body id="GUID-58EAFD35-9DB6-4F9F-970B-DD7C7ED13C8B" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            Jump to main content
        </a>
        
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div class="wh_header_flex_container navbar-nav navbar-expand-md navbar-dark">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <a href="index.html" class=" wh_logo d-none d-sm-block "><img src="oxygen-webhelp\template\resources/images/microchip.png" alt="MPLAB® Harmony 3 USB Library &#xA;    "/></a>
                    <div class=" wh_publication_title "><a href="index.html">MPLAB® Harmony 3 USB Library 
    </a></div>
                    
                </div>
                
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                
                
                
            </div>
        </div>
    </div>
</header>
        
        
         
        
        <div class=" wh_search_input navbar-form wh_topic_page_search search " role="form">
            
            
            
            <form id="searchForm" method="get" role="search" action="search.html"><div class="d-flex justify-contents-around"><div class="flex-grow-1"></div><div class="position-relative flex-grow-1"><input type="search" placeholder="Search " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="Search query" required="required"/><button type="submit" class="wh_search_button" aria-label="Search"><span class="search_input_text">Search</span></button></div><div class="align-self-center flex-grow-1 ml-2"></div></div></form>
            
            <div class="mchp-color-stripe-grid-container">
  <div class="mchp-main-bar mchp-orange-bar"></div>
  <div class="mchp-main-bar mchp-blue-bar"></div>
  <div class="mchp-main-bar mchp-green-bar"></div>
</div>
            
        </div>
        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="index.html"><span>Home</span></a></span></li><li><div class="topicref" data-id="GUID-6AFB98D6-0272-4DED-BBAB-39EECD8DDB5F"><div class="title"><a href="GUID-6AFB98D6-0272-4DED-BBAB-39EECD8DDB5F.html"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4</ph>
USB Common Driver Interface</a></div></div></li><li><div class="topicref" data-id="GUID-7B57189D-AB41-4208-8FBA-0C1C2C9DAE39"><div class="title"><a href="GUID-7B57189D-AB41-4208-8FBA-0C1C2C9DAE39.html"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1</ph>
Common Interface</a></div></div></li><li><div class="topicref" data-id="GUID-4D46C075-0FAB-49DF-8561-98820CD2536B"><div class="title"><a href="GUID-4D46C075-0FAB-49DF-8561-98820CD2536B.html"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1.6</ph>
USB Driver Device Mode Operation</a></div></div></li><li class="active"><div class="topicref" data-id="GUID-58EAFD35-9DB6-4F9F-970B-DD7C7ED13C8B"><div class="title"><a href="GUID-58EAFD35-9DB6-4F9F-970B-DD7C7ED13C8B.html"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1.6.3</ph>
Transferring Data to the Host</a></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="Toggle search highlights" title="Toggle search highlights"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="Collapse sections" title="Collapse sections"></button>
                        
                        
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="Print this page" aria-label="Print this page"></button></div>
                        
                        <button type="button" id="wh_toc_button" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            <div class="row" style="margin-top: -1em;"><div class="col-lg-9 col-md-9 col-sm-12 offset-lg-3 offset-md-3 text-right border-bottom mb-1"><h2 class="text-dark header_title">
    </h2></div></div>
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        <nav id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-12 d-md-block d-none d-print-none" aria-label="Table of Contents Container">
                            <div id="wh_publication_toc_content">
		                        
                            	<div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem" aria-expanded="false"><div data-tocid="GUID-D9F90103-F97D-468D-90FC-EA3E186842D9-d5059e11" class="topicref" data-id="GUID-D9F90103-F97D-468D-90FC-EA3E186842D9" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action GUID-D9F90103-F97D-468D-90FC-EA3E186842D9-d5059e11-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-D9F90103-F97D-468D-90FC-EA3E186842D9.html" id="GUID-D9F90103-F97D-468D-90FC-EA3E186842D9-d5059e11-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1</ph>
Release Information</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="GUID-61902145-0FA6-4DE3-845C-B14852166EAE-d5059e27" class="topicref" data-id="GUID-61902145-0FA6-4DE3-845C-B14852166EAE" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action GUID-61902145-0FA6-4DE3-845C-B14852166EAE-d5059e27-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-61902145-0FA6-4DE3-845C-B14852166EAE.html" id="GUID-61902145-0FA6-4DE3-845C-B14852166EAE-d5059e27-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">2</ph>
USB Device Libraries</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="GUID-B14EBEC0-7590-4740-800B-6CE5FE9AB121-d5059e3093" class="topicref" data-id="GUID-B14EBEC0-7590-4740-800B-6CE5FE9AB121" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action GUID-B14EBEC0-7590-4740-800B-6CE5FE9AB121-d5059e3093-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-B14EBEC0-7590-4740-800B-6CE5FE9AB121.html" id="GUID-B14EBEC0-7590-4740-800B-6CE5FE9AB121-d5059e3093-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">3</ph>
USB Host Libraries</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="GUID-6AFB98D6-0272-4DED-BBAB-39EECD8DDB5F-d5059e5397" class="topicref" data-id="GUID-6AFB98D6-0272-4DED-BBAB-39EECD8DDB5F" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action GUID-6AFB98D6-0272-4DED-BBAB-39EECD8DDB5F-d5059e5397-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-6AFB98D6-0272-4DED-BBAB-39EECD8DDB5F.html" id="GUID-6AFB98D6-0272-4DED-BBAB-39EECD8DDB5F-d5059e5397-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4</ph>
USB Common Driver Interface</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="true"><div data-tocid="GUID-7B57189D-AB41-4208-8FBA-0C1C2C9DAE39-d5059e5405" class="topicref" data-id="GUID-7B57189D-AB41-4208-8FBA-0C1C2C9DAE39" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action GUID-7B57189D-AB41-4208-8FBA-0C1C2C9DAE39-d5059e5405-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-7B57189D-AB41-4208-8FBA-0C1C2C9DAE39.html" id="GUID-7B57189D-AB41-4208-8FBA-0C1C2C9DAE39-d5059e5405-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1</ph>
Common Interface</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="false"><div data-tocid="GUID-DAE7BD2C-129E-4F03-BF5D-3A315C9DEF45-d5059e5413" class="topicref" data-id="GUID-DAE7BD2C-129E-4F03-BF5D-3A315C9DEF45" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action GUID-DAE7BD2C-129E-4F03-BF5D-3A315C9DEF45-d5059e5413-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-DAE7BD2C-129E-4F03-BF5D-3A315C9DEF45.html" id="GUID-DAE7BD2C-129E-4F03-BF5D-3A315C9DEF45-d5059e5413-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1.1</ph>
Driver Host Mode Client Functions</a></div></div></li><li role="treeitem"><div data-tocid="GUID-1B002121-F8DD-4F43-B052-BF0BD1C4CEC6-d5059e5437" class="topicref" data-id="GUID-1B002121-F8DD-4F43-B052-BF0BD1C4CEC6" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="GUID-1B002121-F8DD-4F43-B052-BF0BD1C4CEC6.html" id="GUID-1B002121-F8DD-4F43-B052-BF0BD1C4CEC6-d5059e5437-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1.2</ph>
Driver Device Mode Client Functions</a></div></div></li><li role="treeitem"><div data-tocid="GUID-0F4E88DE-15B9-4CE8-9B09-044A80E81C4D-d5059e5445" class="topicref" data-id="GUID-0F4E88DE-15B9-4CE8-9B09-044A80E81C4D" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="GUID-0F4E88DE-15B9-4CE8-9B09-044A80E81C4D.html" id="GUID-0F4E88DE-15B9-4CE8-9B09-044A80E81C4D-d5059e5445-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1.3</ph>
Driver General Client Functions</a></div></div></li><li role="treeitem"><div data-tocid="GUID-655F3E4F-8C51-4725-9838-73500FD7AF00-d5059e5453" class="topicref" data-id="GUID-655F3E4F-8C51-4725-9838-73500FD7AF00" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="GUID-655F3E4F-8C51-4725-9838-73500FD7AF00.html" id="GUID-655F3E4F-8C51-4725-9838-73500FD7AF00-d5059e5453-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1.4</ph>
Opening the Driver</a></div></div></li><li role="treeitem"><div data-tocid="GUID-364A16EE-4ABA-46E5-91D2-DD954EEEA6E1-d5059e5461" class="topicref" data-id="GUID-364A16EE-4ABA-46E5-91D2-DD954EEEA6E1" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="GUID-364A16EE-4ABA-46E5-91D2-DD954EEEA6E1.html" id="GUID-364A16EE-4ABA-46E5-91D2-DD954EEEA6E1-d5059e5461-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1.5</ph>
USB Driver Host Mode Operation</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="GUID-4D46C075-0FAB-49DF-8561-98820CD2536B-d5059e5469" class="topicref" data-id="GUID-4D46C075-0FAB-49DF-8561-98820CD2536B" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action GUID-4D46C075-0FAB-49DF-8561-98820CD2536B-d5059e5469-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-4D46C075-0FAB-49DF-8561-98820CD2536B.html" id="GUID-4D46C075-0FAB-49DF-8561-98820CD2536B-d5059e5469-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1.6</ph>
USB Driver Device Mode Operation</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="GUID-D05EF720-82F8-498C-91FC-A1C08955D570-d5059e5477" class="topicref" data-id="GUID-D05EF720-82F8-498C-91FC-A1C08955D570" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="GUID-D05EF720-82F8-498C-91FC-A1C08955D570.html" id="GUID-D05EF720-82F8-498C-91FC-A1C08955D570-d5059e5477-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1.6.1</ph>
General Device Mode Operations</a></div></div></li><li role="treeitem"><div data-tocid="GUID-A46EB55F-A77A-4E57-A921-096F2396F51A-d5059e5485" class="topicref" data-id="GUID-A46EB55F-A77A-4E57-A921-096F2396F51A" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="GUID-A46EB55F-A77A-4E57-A921-096F2396F51A.html" id="GUID-A46EB55F-A77A-4E57-A921-096F2396F51A-d5059e5485-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1.6.2</ph>
Device Endpoint Operations</a></div></div></li><li role="treeitem" class="active"><div data-tocid="GUID-58EAFD35-9DB6-4F9F-970B-DD7C7ED13C8B-d5059e5493" class="topicref" data-id="GUID-58EAFD35-9DB6-4F9F-970B-DD7C7ED13C8B" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="GUID-58EAFD35-9DB6-4F9F-970B-DD7C7ED13C8B.html" id="GUID-58EAFD35-9DB6-4F9F-970B-DD7C7ED13C8B-d5059e5493-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">4.1.6.3</ph>
Transferring Data to the Host</a></div></div></li></ul></li></ul></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="GUID-0FB3F908-88EE-45CE-94F5-E97AF9049C9B-d5059e5501" class="topicref backmatter backmatter_parent" data-id="GUID-0FB3F908-88EE-45CE-94F5-E97AF9049C9B" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action GUID-0FB3F908-88EE-45CE-94F5-E97AF9049C9B-d5059e5501-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-0FB3F908-88EE-45CE-94F5-E97AF9049C9B.html" id="GUID-0FB3F908-88EE-45CE-94F5-E97AF9049C9B-d5059e5501-link">Microchip Information</a></div></div></li></ul></div>
		                        
                            </div>
                        </nav>
                    
                    
                    <div class="col-lg-9 col-md-9 col-sm-12" id="wh_topic_body">
                        <button id="wh_close_publication_toc_button" class="close-toc-button d-none" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        
                        
                        <div class=" wh_topic_content body "><main role="main"><article role="article" aria-labelledby="GUID-58EAFD35-9DB6-4F9F-970B-DD7C7ED13C8B__GUID-699247B0-1DE9-472C-AB5D-5901121DA99C">
<h1 class="- topic/title title topictitle1" id="GUID-58EAFD35-9DB6-4F9F-970B-DD7C7ED13C8B__GUID-699247B0-1DE9-472C-AB5D-5901121DA99C" style="">4.1.6.3 Transferring Data to the Host</h1>
    <div class="- topic/body body">
        <p class="- topic/p p">The USB Device Layer, the USBCD client, needs to transfer data to the Host in response to
            enumeration requests for general operation on the device. The USB uses a concept of
            Input Output Request Packet (IRP) to transfer data to and from the Host. IRPs are
            transported over endpoints which are enabled by calling the USBCD Endpoint Enable
            function. </p>
        <p class="- topic/p p">A Device IRP is a USB_DEVICE_IRP type data structure. The IRP is created by the Device
            Layer and submitted to the USBCD for processing through the deviceIRPSubmit function. At
            the time of submitting the IRP, the endpoint over which the IRP must be transported is
            specified. The data request in the IRP is transported using the attributes of the
            endpoint. When an IRP is submitted to the USBCD, it is owned by the USBCD and cannot be
            modified by the Device Layer until the USBCD issues an IRP callback. The USBCD will
            issue the IRP callback when it has completed or terminated processing of the IRP. </p>
        <p class="- topic/p p">An IRP does not have its own transfer type. It inherits the properties of the endpoint to
            which it is submitted. Hence an IRP becomes a control transfer IRP it was submitted to a
            control endpoint. An endpoint allows multiple IRPs to be queued. This allows the Device
            Layer to submit IRPs to an endpoint even while an IRP is being processed on the
            endpoint. The USBCD will process an IRP in the order that it was received. The following
            code example shows the USB_DEVICE_IRP data structure:</p>
        <pre class="- topic/pre pre" id="GUID-58EAFD35-9DB6-4F9F-970B-DD7C7ED13C8B__PRE_NC1_V3F_Q1C" data-ofbid="GUID-58EAFD35-9DB6-4F9F-970B-DD7C7ED13C8B__PRE_NC1_V3F_Q1C"><em class="+ topic/ph hi-d/i ph i">/* This code example shows the USB_DEVICE_IPR structure. The Device Layer
 * uses such a structure to transfer data through the driver. A structure of
 * this type is allocated by the Device Layer and the other function drivers and
 * passed to the deviceIRPSubmit function. */</em>
<strong class="+ topic/ph hi-d/b ph b">typedef</strong><strong class="+ topic/ph hi-d/b ph b">struct</strong> _USB_DEVICE_IRP
{
    <em class="+ topic/ph hi-d/i ph i">/* Pointer to the data buffer */</em>
    <strong class="+ topic/ph hi-d/b ph b">void</strong> * data;

    <em class="+ topic/ph hi-d/i ph i">/* Size of the data buffer */</em>
    <strong class="+ topic/ph hi-d/b ph b">unsigned</strong><strong class="+ topic/ph hi-d/b ph b">int</strong> size;

    <em class="+ topic/ph hi-d/i ph i">/* Status of the IRP */</em>
    USB_DEVICE_IRP_STATUS status;

    <em class="+ topic/ph hi-d/i ph i">/* IRP Callback. If this is NULL, then there is no callback generated */</em>
    <strong class="+ topic/ph hi-d/b ph b">void</strong> (*callback)(<strong class="+ topic/ph hi-d/b ph b">struct</strong> _USB_DEVICE_IRP * irp);

    <em class="+ topic/ph hi-d/i ph i">/* Request specific flags */</em>
    USB_DEVICE_IRP_FLAG flags;

    <em class="+ topic/ph hi-d/i ph i">/* User data */</em>
    uintptr_t userData;

    <em class="+ topic/ph hi-d/i ph i">/***********************************
     * The following members should not
     * be modified by the client
     ***********************************/</em>
    uint32_t privateData[3];

} USB_DEVICE_IRP;</pre>
        <p class="- topic/p p">The <code class="+ topic/ph pr-d/codeph ph codeph">data</code> member of the USB_DEVICE_IRP structure points to a data buffer.
            This data buffer will contain the data that needs to be sent to the Host for the data
            stage of an IN transfer. For an OUT transfer, it will contain the data that was received
            from the Host. Any hardware specific cache coherency and address alignment requirements
            must be considered while allocating this data buffer. The Driver Client should not
            modify or examine the contents of the IRP after the IRP has been submitted and is being
            processed. It can be examined after the driver has released the IRP. </p>
        <p class="- topic/p p">The <code class="+ topic/ph pr-d/codeph ph codeph">size</code> member of the USB_DEVICE_IRP structure specifies the size of
            the data buffer. The transfer will end when the device has sent or received size number
            of bytes. While sending data to the Host, the IRP size can exceed the size of the
            transaction (which is equal to the size of the endpoint). The USBCD in such a case will
            split up the transfer into transactions. This process does not require external
            intervention. The driver uses receive and transmit IRPs to process control transfers.
            When the driver receives a Setup packet, the IRP completion status would be
            USB_DEVICE_IRP_STATUS. The Driver Client should then use additional receive and transmit
            IRPs to complete the control transfer. </p>
        <p class="- topic/p p">For interrupt and isochronous transfers, the size of transfer specified in the IRP cannot
            exceed the size of the transaction. If size is specified as 0, then the driver will send
            or expect a zero length packet. The <code class="+ topic/ph pr-d/codeph ph codeph">size</code> parameter of the IRP is
            updated by the driver when IRP processing is completed. This will contain the size of
            the completed transfer. </p>
        <p class="- topic/p p">The <code class="+ topic/ph pr-d/codeph ph codeph">status</code> member of the IRP provides the completion status of the IRP
            and should be checked only when the IRP processing has completed. This is indicated by
            the driver calling the IRP callback function. The IRP status is a USB_DEVICE_IRP_STATUS
            type. The following code example shows the different possible values of the
                <code class="+ topic/ph pr-d/codeph ph codeph">status</code> member and example usage of IRPs to transfer data between
            the device and the Host.</p>
        <pre class="- topic/pre pre" id="GUID-58EAFD35-9DB6-4F9F-970B-DD7C7ED13C8B__PRE_OC1_V3F_Q1C" data-ofbid="GUID-58EAFD35-9DB6-4F9F-970B-DD7C7ED13C8B__PRE_OC1_V3F_Q1C"><em class="+ topic/ph hi-d/i ph i">/* The followoing code shows example usage of the device IRP. The submit status
 * of the IRP is available when IRP submit function returns. The completion
 * status of the IRP is available when the IRP has terminated and the IRP
 * callback function is invoked. The IRP callback
 * function shown in this example shows the possible complete status of the IRP.
 * The end application may or may not handle all the cases. Multiple IRPs can be
 * queued on an endpoint. */</em>
<strong class="+ topic/ph hi-d/b ph b">void</strong> IRP_Callback(USB_DEVICE_IRP * irp)
{
    <em class="+ topic/ph hi-d/i ph i">/* irp is pointing to the IRP for which the callback has occurred. In most
     * cases this function will execute in an interrupt context. The application
     * should not perform any hardware access or interrupt unsafe operations in
     * this function. */</em>
    <strong class="+ topic/ph hi-d/b ph b">switch</strong>(irp-&gt;status)
    {
        <strong class="+ topic/ph hi-d/b ph b">case</strong> USB_DEVICE_IRP_STATUS_TERMINATED_BY_HOST:
            <em class="+ topic/ph hi-d/i ph i">/* The IRP was aborted because the Host cleared the stall on the
             * endpoint */</em>
            <strong class="+ topic/ph hi-d/b ph b">break</strong>;

        <strong class="+ topic/ph hi-d/b ph b">case</strong> USB_DEVICE_IRP_STATUS_ABORTED_ENDPOINT_HALT:
            <em class="+ topic/ph hi-d/i ph i">/* IRP was aborted because the endpoint halted */</em>
            <strong class="+ topic/ph hi-d/b ph b">break</strong>;


        <strong class="+ topic/ph hi-d/b ph b">case</strong> USB_DEVICE_IRP_STATUS_ABORTED:
            <em class="+ topic/ph hi-d/i ph i">/* USB Device IRP was aborted by the function driver */</em>
            <strong class="+ topic/ph hi-d/b ph b">break</strong>;

        <strong class="+ topic/ph hi-d/b ph b">case</strong> USB_DEVICE_IRP_STATUS_ERROR:
            <em class="+ topic/ph hi-d/i ph i">/* An error occurred on the bus when the IRP was being processed */</em>
            <strong class="+ topic/ph hi-d/b ph b">break</strong>;

        <strong class="+ topic/ph hi-d/b ph b">case</strong> USB_DEVICE_IRP_STATUS_COMPLETED:
            <em class="+ topic/ph hi-d/i ph i">/* The IRP was completed */</em>
            <strong class="+ topic/ph hi-d/b ph b">break</strong>;

        <strong class="+ topic/ph hi-d/b ph b">case</strong> USB_DEVICE_IRP_STATUS_COMPLETED_SHORT:
            <em class="+ topic/ph hi-d/i ph i">/* The IRP was completed but the amount of data received was less
             * than the requested size */</em>
            <strong class="+ topic/ph hi-d/b ph b">break</strong>;

        <strong class="+ topic/ph hi-d/b ph b">default</strong>:
            <strong class="+ topic/ph hi-d/b ph b">break</strong>;

    }
}

<em class="+ topic/ph hi-d/i ph i">/* In the following example, the IRP is submitted to Endpoint 0x84. This is
 * interpreted as an IN direction endpoint (MSB of 0x84 is 1) and Endpoint 4.
 * The data contained in source will be sent to the USB Host. Assuming
 * the endpoint size is 64, the 130 bytes of data in this case will be sent to
 * the Host in three transaction of 64, 64 and 2 bytes. A transaction completes
 * when the Host polls (sends an IN token) the device.  The callback function
 * will then called indicating the completion status of the IRP. The application
 * should not modify the privateData field of the IRP. If the IRP was submitted
 * successfully, the buffer will be owned by the driver until the IRP callback
 * function has been called. Because the size of the transfer is not a multiple
 * of the endpoint size, the IRP flag must be set
 * USB_DEVICE_IRP_FLAG_DATA_COMPLETE. This directs the driver to not perform any
 * explicit signaling to the Host to indicate end of transfer. The last packet
 * in this case is a short packet and this signals the end of the transfer. */</em>

USB_DEVICE_IRP irp;
USB_ERROR result;
uint8_t source[130];

irp.data = source;
irp.size = 130;
irp.called = IRP_Callback;
flags = USB_DEVICE_IRP_FLAG_DATA_COMPLETE;
userData = &amp;someApplicationObject;

result = DRV_USBFS_DEVICE_IRPSubmit(driverHandle, 0x84, &amp;irp);

<strong class="+ topic/ph hi-d/b ph b">switch</strong>(result)
{
    <strong class="+ topic/ph hi-d/b ph b">case</strong> USB_ERROR_PARAMETER_INVALID:
        <em class="+ topic/ph hi-d/i ph i">/* This can happen if the driverHandle is invalid */</em>
        <strong class="+ topic/ph hi-d/b ph b">break</strong>;

    <strong class="+ topic/ph hi-d/b ph b">case</strong> USB_ERROR_DEVICE_IRP_IN_USE:
        <em class="+ topic/ph hi-d/i ph i">/* This can happen if the IRP is being resubmitted while it is still in
         * process (it was submitted before but processing has not completed */</em>
        <strong class="+ topic/ph hi-d/b ph b">break</strong>;

    <strong class="+ topic/ph hi-d/b ph b">case</strong> USB_ERROR_DEVICE_ENDPOINT_INVALID;
        <em class="+ topic/ph hi-d/i ph i">/* The endpoint to which this IRP is being submitted is not provisioned
         * in the system. This is controller by DRV_USBFS_ENDPOINTS_NUMBER
         * configuration parameter. */</em>
        <strong class="+ topic/ph hi-d/b ph b">break</strong>;

    <strong class="+ topic/ph hi-d/b ph b">case</strong> USB_ERROR_ENDPOINT_NOT_CONFIGURED:
        <em class="+ topic/ph hi-d/i ph i">/* The endpoint to which this IRP is being submitted is not enabled. It
         * must be enabled by calling the DRV_USBFS_DEVICE_EndpointEnable()
         * function. */</em>
        <strong class="+ topic/ph hi-d/b ph b">break</strong>;

    <strong class="+ topic/ph hi-d/b ph b">case</strong> USB_ERROR_PARAMETER_INVALID:
        <em class="+ topic/ph hi-d/i ph i">/* The USB_DEVICE_IRP_FLAG_DATA_PENDING flag was specified but the
         * transfer size is not a multiple of the endpoint size. If the IRP was
         * submitted to a receive endpoint, this error can occur if the size is
         * not a multiple of the endpoint size. */</em>
        <strong class="+ topic/ph hi-d/b ph b">break</strong>;

    <strong class="+ topic/ph hi-d/b ph b">case</strong> USB_ERROR_OSAL_FUNCTION:
        <em class="+ topic/ph hi-d/i ph i">/* An error occurred while trying to grab a mutex. This is applicable
         * when the driver is running with a RTOS. */</em>
        <strong class="+ topic/ph hi-d/b ph b">break</strong>;

    <strong class="+ topic/ph hi-d/b ph b">case</strong> USB_ERROR_NONE:
        <em class="+ topic/ph hi-d/i ph i">/* The IRP was submitted successfully. */</em>
        <strong class="+ topic/ph hi-d/b ph b">break</strong>;

    <strong class="+ topic/ph hi-d/b ph b">default</strong>:
        <strong class="+ topic/ph hi-d/b ph b">break</strong>;
}

<em class="+ topic/ph hi-d/i ph i">/* The following code example shows how an IRP is submitted to an OUT endpoint.
 * In this case data will be pointing to a buffer where the received data will
 * be stored. Note that the size of the IRP should be a multiple of the endpoint
 * size. The flags parameter is ignored in the data receive case. The IRP
 * terminates when the specified size of bytes has been received (the Host sends
 * OUT packets) or when a short packet has been received. */</em>

USB_DEVICE_IRP irp;
USB_ERROR result;
uint8_t destination[128];

irp.data = destination;
irp.size = 128;
irp.called = IRP_Callback;
userData = &amp;someApplicationObject;

result = DRV_USBFS_DEVICE_IRPSubmit(driverHandle, 0x04, &amp;irp);</pre>
        <p class="- topic/p p">For IRPs submitted to an Interrupt or Isochronous endpoints, the driver will always send
            either the less than or equal to the maximum endpoint packet size worth of bytes in a
            transaction. The application could either submit an IRP per Interrupt/Isochronous
            polling interval or it could submit one IRP for multiple polling intervals. </p>
        <p class="- topic/p p">The <code class="+ topic/ph pr-d/codeph ph codeph">flags</code> member of the USB_DEVICE_IRP structure specifies flags which
            affect the behavior of the IRP. The USB_DEVICE_IRP_FLAG enumeration specifies the
            available option. The USB_DEVICE_IRP_FLAG_DATA_COMPLETE causes the driver to add a Zero
            Length Packet (ZLP) to the data stage of the IN transfer when the transfer size is an
            exact multiple of the endpoint size. If the transfer size is not a multiple of the
            endpoint size, no ZLP will be sent. The USB_DEVICE_IRP_FLAG_PENDING flag will cause the
            driver to not send a ZLP in a case where the size of the IN transfer is an exact
            multiple of the endpoint size. The following code example demonstrates this.</p>
        <pre class="- topic/pre pre" id="GUID-58EAFD35-9DB6-4F9F-970B-DD7C7ED13C8B__PRE_PC1_V3F_Q1C" data-ofbid="GUID-58EAFD35-9DB6-4F9F-970B-DD7C7ED13C8B__PRE_PC1_V3F_Q1C"><em class="+ topic/ph hi-d/i ph i">/* In the following code example, the IRP is submitted to an IN endpoint whose size
 * is 64. The transfer size is 128, which is an exact multiple of the endpoint
 * size. The flag is set to USB_DEVICE_IRP_FLAG_DATA_COMPLETE. The driver
 * will send two transactions of 64 bytes each and will then automatically send a
 * Zero Length Packet (ZLP), thus completing the transfer. The IRP callback will
 * be invoked when the ZLP transaction has completed. */</em>

USB_DEVICE_IRP irp;
USB_ERROR result;
uint8_t source[128];

irp.data = source;
irp.size = 128;
irp.called = IRP_Callback;
flags = USB_DEVICE_IRP_FLAG_DATA_COMPLETE;
userData = &amp;someApplicationObject;

result = DRV_USBFS_DEVICE_IRPSubmit(driverHandle, 0x84, &amp;irp);

<em class="+ topic/ph hi-d/i ph i">/* In the following code example, the IRP is submitted to an IN endpoint whose size
 * is 64. The transfer size is 128, which is an exact multiple of the endpoint
 * size. The flag is set to to USB_DEVICE_IRP_FLAG_DATA_PENDING. The driver will
 * send two transactions of 64 bytes each but will not send a ZLP. The USB Host
 * can then consider that there is more data pending in the transfer. The IRP
 * callback will be invoked when the two transactions have completed. */</em>

USB_DEVICE_IRP irp;
USB_ERROR result;
uint8_t source[128];

irp.data = source;
irp.size = 128;
irp.called = IRP_Callback;
flags = USB_DEVICE_IRP_FLAG_DATA_COMPLETE;
userData = &amp;someApplicationObject;

result = DRV_USBFS_DEVICE_IRPSubmit(driverHandle, 0x84, &amp;irp);</pre>
        <p class="- topic/p p">The <code class="+ topic/ph pr-d/codeph ph codeph">callback</code> member of the USB_DEVICE_IRP structure points to a function
            which the driver calls when the IRP processing is completed. The Driver Client must
            implement this function and assign the pointer to this function to the
                <code class="+ topic/ph pr-d/codeph ph codeph">callback</code> member of the IRP. Every IRP can have its own callback
            function or one common callback function could be used. The callback function will
            execute in an interrupt context. The Driver Client should not execute interrupt unsafe,
            blocking or computationally intensive operations in the callback function. The client
            can call deviceIRPSubmit function in the IRP callback function to submit another IRP or
            resubmit the same IRP. The client can check the status and size of the IRP in the
            callback function. </p>
        <p class="- topic/p p">The <code class="+ topic/ph pr-d/codeph ph codeph">userData</code> member of the USB_DEVICE_IRP structure can be used by the
            client to associate a client specific context with the Host. This context can then be
            used by the client, in the IRP callback function to identify the context in which the
            IRP was submitted. This member is particularly useful if the client wants to implement
            one callback function for all IRPs. </p>
        <p class="- topic/p p">The <code class="+ topic/ph pr-d/codeph ph codeph">privateData</code> member of the IRP is used by the driver and should not
            be accessed or manipulated by the Driver Client.</p>
    </div>
</article></main></div>
                        
                        
                        
                        
                        
                        
                    </div>
                    
                </div>
            </div>
            
            
            
        </div> 
        <footer class="navbar navbar-default wh_footer">
  <div class=" footer-container mx-auto ">
    <div class="footer">
  <div class="mchp-wh-footer">
    <div class="mchp-footer">
      <div class="mchp-footer-tier1">
        <div class="spacer"></div>
        <div class="mchp-footer-container">
          <div class="mchp-footer-links mchp-social-media-links">
            <div class="mchp-component-items">
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.facebook.com/pages/Microchip-Technology-Inc/20320981741" target="_blank">
                  <img class="cmp-image__image" alt="Microchip Facebook" src="oxygen-webhelp/template/resources/images/201016-corp-facebook.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.linkedin.com/company/microchip-technology" target="_blank">
                  <img class="cmp-image__image" alt="Microchip LinkedIn" src="oxygen-webhelp/template/resources/images/201016-corp-linkedin.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://twitter.com/MicrochipTech" target="_blank">
                  <img class="cmp-image__image" alt="Microchip Twitter" src="oxygen-webhelp/template/resources/images/201016-corp-twitter.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.youtube.com/user/MicrochipTechnology" target="_blank">
                  <img class="cmp-image__image" alt="Microchip YouTube" src="oxygen-webhelp/template/resources/images/201016-corp-youtube.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.instagram.com/microchiptechnologyinc/" target="_blank">
                  <img class="cmp-image__image" alt="Microchip Instagram" src="oxygen-webhelp/template/resources/images/201016-corp-instagram.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.weibo.com/microchiptech" target="_blank">
                  <img class="cmp-image__image" alt="Microchip Weibo" src="oxygen-webhelp/template/resources/images/201016-corp-weibo.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.microchip.com/en-us/about/blog" target="_blank">
                  <img class="cmp-image__image" alt="Microchip Blog" src="oxygen-webhelp/template/resources/images/201016-corp-blog.png"/>
                </a>
              </div>
            </div>
          </div>
          <div class="mchp-footer-links">
            <div class="mchp-component-items">
              <div class="mchp-component-item">
                <div class="link">
                  <a href="https://www.microchip.com/about-us/contact-us" class="mchp-link__link">Contact</a>
                  <span class="mchp-link__separator">|</span>
                </div>
              </div>
              <div class="mchp-component-item ">
                <div class="link">
                  <a href="https://www.microchip.com/en-us/about/legal-information" class="mchp-link__link">Legal</a>
                  <span class="mchp-link__separator">|</span>
                </div>
              </div>
              <div class="mchp-component-item ">
                <div class="link">
                  <a href="https://www.microchip.com/en-us/about/legal-information/privacy-policy" class="mchp-link__link">Privacy Policy</a>
                  <span class="mchp-link__separator">|</span>
                </div>
              </div>
              <div class="mchp-component-item ">
                <div class="link">
                  <a href="https://www.microchip.com/en-us/about/legal-information/microchip-cookie-statement" class="mchp-link__link">Cookies</a>
                  <span class="mchp-link__separator">|</span>
                </div>
              </div>
              <div class="mchp-component-item">
                <div class="link">
                  <a href="https://careers.microchip.com/" class="mchp-link__link">Careers</a>
                  <span class="mchp-link__separator"></span>
                </div>
              </div>
            </div>
          </div>
          <div class="mchp-footer-newsletter">
            <div class="cmp-text">
              <p>Stay on the leading edge with our blog</p>
            </div>
            <div class="mchp-button-wrapper">
              <a role="button" href="https://www.microchip.com/en-us/about/blog" class="mchp-button mchp-button-regular solid">
                <span class="mchp-button__span">MicroSolutions</span>
              </a>
            </div>
          </div>
        </div>
        <div class="graphic">
          <img src="oxygen-webhelp/template/resources/images/footer-graphic.png"/>
        </div>
      </div>
      <div class="mchp-footer-tier2">
        <p class="mchp-copyright">© Copyright 1998-2022 Microchip Technology Inc. All rights reserved.</p>
      </div>
    </div>
  </div>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async="true" src="https://www.googletagmanager.com/gtag/js?id=UA-2724382-19"></script>
  <script>
    window.dataLayer = window.dataLayer || [];  
    function gtag(){dataLayer.push(arguments);}  
    gtag('js', new Date());   
    gtag('config', 'UA-2724382-19');
  </script>
  
  <script type="text/javascript">_satellite.pageBottom();</script><!-- Adobe Analytics -->
  <script type="text/javascript" src="mchp-js/prepend.js"></script><!-- Package for viewing PDFs on mobile devices -->
  
</div>
  </div>
</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <div id="modal_img_container"></div>
            <div id="caption"></div>
        </div>
        
        
        
       
        </body>
</html>